  <!DOCTYPE html>
  <html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Space</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
      :root {
        --primary: #0f172a;
        --accent: #3b82f6;
        --accent-hover: #2563eb;
        --bg-body: #f8fafc;
        --bg-card: #ffffff;
        --text-main: #1e293b;
        --text-sub: #64748b;
        --border: #e2e8f0;
        --danger: #ef4444;
        --success: #16a34a;

        --radius-lg: 20px;
        --radius-md: 12px;
        --radius-sm: 8px;

        --shadow-card: 0 4px 18px rgba(15, 23, 42, 0.06);
        --shadow-hover: 0 16px 32px rgba(15, 23, 42, 0.08);
        --shadow-menu: 0 10px 25px rgba(15, 23, 42, 0.12);
      }

      * {
        box-sizing: border-box;
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: 'Plus Jakarta Sans', sans-serif;
        background-color: var(--bg-body);
        color: var(--text-main);
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }

      /* NAVBAR */
      .nav-bar {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--border);
        padding: 10px 16px;
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .nav-left {
        display: flex;
        align-items: center;
        gap: 16px;
        min-width: 0;
      }

      .brand {
        font-weight: 800;
        font-size: 1.1rem;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        white-space: nowrap;
      }

      .brand-logo {
        width: 32px;
        height: 32px;
        border-radius: 10px;
        background: linear-gradient(135deg, #0f172a, #3b82f6);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
        box-shadow: 0 4px 10px rgba(15, 23, 42, 0.35);
      }

      .brand-sub {
        font-size: 0.7rem;
        color: var(--text-sub);
      }

      .breadcrumb-container {
        display: none;
        align-items: center;
        gap: 8px;
        overflow-x: auto;
        scrollbar-width: none;
      }

      @media (min-width: 768px) {
        .breadcrumb-container {
          display: flex;
        }
      }

      .crumb {
        display: inline-flex;
        align-items: center;
        padding: 5px 11px;
        border-radius: 100px;
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-sub);
        background: transparent;
        text-decoration: none;
        transition: all 0.2s;
        white-space: nowrap;
      }

      .crumb:hover {
        background: #e2e8f0;
        color: var(--primary);
      }

      .crumb.active {
        background: #eff6ff;
        color: var(--accent);
      }

      .crumb-sep {
        color: var(--border);
        font-size: 0.8rem;
      }

      .search-wrapper {
        position: relative;
        display: none;
        flex: 1 1 auto;
        max-width: 280px;
      }

      @media (min-width: 768px) {
        .search-wrapper {
          display: block;
        }
      }

      .search-input {
        width: 100%;
        padding: 8px 14px 8px 34px;
        background: #f1f5f9;
        border-radius: 999px;
        border: 1px solid transparent;
        font-size: 0.85rem;
        transition: all 0.18s;
      }

      .search-input::placeholder {
        color: #9ca3af;
      }

      .search-input:focus {
        background: #ffffff;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.18);
      }

      .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-sub);
        font-size: 0.75rem;
      }

      .nav-right {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .user-chip {
        display: none;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        background: #eff6ff;
        color: var(--primary);
        font-size: 0.8rem;
      }

      .user-avatar {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        background: #0f172a;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        text-transform: uppercase;
      }

      @media (min-width: 640px) {
        .user-chip {
          display: inline-flex;
        }
      }

      .btn-logout {
        border: none;
        background: #fee2e2;
        color: #b91c1c;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        transition: background 0.15s, transform 0.08s;
      }

      .btn-logout:hover {
        background: #fecaca;
      }

      .btn-logout:active {
        transform: scale(0.96);
      }

      .nav-toggle {
        border: none;
        background: transparent;
        font-size: 1.1rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      @media (min-width: 768px) {
        .nav-toggle {
          display: none;
        }
      }

      /* Drag selection box */
  .selection-box {
    position: fixed;
    background: rgba(59, 130, 246, 0.15);
    border: 1px solid #3b82f6;
    z-index: 9999;
    pointer-events: none;
    border-radius: 4px;
  }

  /* Selected file style */
  .file-card.selected {
    background: #eff6ff;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59,130,246,0.25);
  }

  .file-card.selected .checkbox-wrapper {
    opacity: 1;
  }


      .nav-mobile-panel {
        display: none;
        flex-direction: column;
        gap: 10px;
        padding: 10px 16px 14px 16px;
        border-bottom: 1px solid var(--border);
        background: #ffffff;
      }

      .nav-mobile-panel.show {
        display: flex;
      }

      .nav-mobile-search {
        position: relative;
      }

      .nav-mobile-search input {
        width: 100%;
        padding: 8px 14px 8px 32px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: #f8fafc;
        font-size: 0.85rem;
      }

      .nav-mobile-search .search-icon {
        left: 10px;
      }

      /* MAIN */
      .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px 16px 40px 16px;
      }

      /* Dashboard header layout */
      .dashboard-header {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 32px;
      }

      @media (min-width: 1024px) {
        .dashboard-header {
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
        }
      }

      /* Stats cards row */
      .stats-group {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
      }

      /* Stat pill style like screenshot */
      .stat-card {
        background: #ffffff;
        border-radius: 18px;
        padding: 16px 20px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.04);
        min-width: 220px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .stat-icon-wrap {
        width: 40px;
        height: 40px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 1rem;
      }

      .stat-icon-db {
        background: #e0ecff;
        color: #2563eb;
      }

      .stat-icon-files {
        background: #fef3c7;
        color: #d97706;
      }

      .stat-content {
        display: flex;
        flex-direction: column;
      }

      .stat-val {
        font-size: 1.4rem;
        font-weight: 700;
        color: #020617;
      }

      .stat-label {
        font-size: 0.82rem;
        color: #64748b;
        font-weight: 500;
      }

      /* Header right side */
      .header-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .folder-form {
        display: flex;
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
        background: #ffffff;
      }

      .folder-form input[type="text"] {
        border: none;
        padding: 0 14px;
        min-width: 160px;
        font-size: 0.85rem;
      }

      .folder-form input[type="text"]:focus {
        outline: none;
      }

      .folder-form .btn-folder-add {
        border-radius: 0;
        border: none;
        padding-inline: 18px;
        background: #020617;
        color: #ffffff;
      }

      .btn-bulk-pill {
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        padding-inline: 16px;
        background: #ffffff;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .btn-bulk-pill i {
        margin-right: 6px;
      }

      /* Mobile responsiveness for header */
      @media (max-width: 640px) {
        .stats-group {
          width: 100%;
        }

        .stat-card {
          flex: 1 1 100%;
        }

        .header-actions {
          width: 100%;
          flex-direction: column;
        }

        .folder-form {
          width: 100%;
        }

        .folder-form input[type="text"] {
          flex: 1;
        }

        .btn-bulk-pill {
          width: 100%;
          justify-content: center;
        }
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 9px 18px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 0.85rem;
        border: none;
        cursor: pointer;
        text-decoration: none;
        transition: transform 0.08s, box-shadow 0.16s, background 0.16s;
        background: transparent;
      }

      .btn:active {
        transform: scale(0.97);
      }

      .btn-primary {
        background: var(--primary);
        color: #ffffff;
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.2);
      }

      .btn-primary:hover {
        background: #1e293b;
      }

      .btn-ghost {
        background: transparent;
        color: var(--text-sub);
      }

      .btn-ghost:hover {
        background: #f1f5f9;
        color: var(--primary);
      }

      .btn-ghost-icon {
        padding: 7px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        font-size: 0.8rem;
      }

      /* Upload area */
      .upload-area {
        border: 2px dashed var(--border);
        border-radius: var(--radius-lg);
        padding: 26px;
        text-align: center;
        transition: all 0.2s;
        cursor: pointer;
        background: #ffffff;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
      }

      .upload-area::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top, rgba(59, 130, 246, 0.08), transparent 55%);
        opacity: 0;
        transition: opacity 0.25s;
      }

      .upload-area:hover {
        border-color: var(--accent);
        background: #f9fbff;
        box-shadow: var(--shadow-card);
      }

      .upload-area:hover::after {
        opacity: 1;
      }

      .upload-area.drag-over {
        border-color: var(--accent);
        background: #eff6ff;
        transform: translateY(-1px);
        box-shadow: var(--shadow-hover);
      }

      .upload-icon {
        font-size: 2rem;
        color: var(--accent);
        margin-bottom: 8px;
        animation: floatIcon 2.4s ease-in-out infinite;
      }

      .upload-text {
        font-weight: 500;
        color: var(--text-sub);
        font-size: 0.9rem;
      }

      @keyframes floatIcon {
        0% {
          transform: translateY(0);
        }

        50% {
          transform: translateY(-4px);
        }

        100% {
          transform: translateY(0);
        }
      }

      .section-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        gap: 12px;
      }

      .section-title {
        font-size: 1.05rem;
        font-weight: 700;
        color: var(--primary);
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .section-title i {
        color: #9ca3af;
        font-size: 0.9rem;
      }

      /* Folders */
      .folder-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 14px;
        margin-bottom: 30px;
      }

      .folder-card {
        background: #ffffff;
        border-radius: var(--radius-md);
        padding: 14px;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.18s;
        text-decoration: none;
        color: var(--text-main);
        position: relative;
      }

      .folder-card:hover {
        border-color: var(--accent);
        box-shadow: var(--shadow-card);
        transform: translateY(-2px);
      }

      .folder-card.drag-target {
        outline: 2px dashed var(--accent);
        outline-offset: 3px;
        background: #eff6ff;
      }

      .folder-info {
        display: flex;
        align-items: center;
        gap: 10px;
        overflow: hidden;
        flex: 1;
      }

      .folder-icon {
        color: #f59e0b;
        font-size: 1.2rem;
      }

      .folder-name {
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 0.9rem;
      }

      /* Files */
      .file-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 18px;
      }

      .file-card {
        background: #ffffff;
        border-radius: var(--radius-lg);
        padding: 16px;
        border: 1px solid transparent;
        box-shadow: var(--shadow-card);
        position: relative;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
      }

      .file-card:hover {
        transform: translateY(-3px);
        border-color: #bfdbfe;
        box-shadow: var(--shadow-hover);
      }

      .checkbox-wrapper {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 2;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .file-checkbox {
        width: 16px;
        height: 16px;
        cursor: pointer;
        accent-color: var(--accent);
      }

      .file-card:hover .checkbox-wrapper,
      .checkbox-wrapper:has(input:checked) {
        opacity: 1;
      }

      .menu-trigger {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 28px;
        height: 28px;
        border-radius: 999px;
        border: none;
        background: transparent;
        color: var(--text-sub);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3;
        transition: background 0.15s, color 0.15s;
      }

      .menu-trigger:hover {
        background: #f1f5f9;
        color: var(--primary);
      }

      .card-body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 120px;
        cursor: pointer;
      }

      .file-icon-box {
        width: 60px;
        height: 60px;
        border-radius: 16px;
        background: #f8fafc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 10px;
        color: var(--text-sub);
        transition: transform 0.18s;
      }

      .file-card:hover .file-icon-box {
        transform: translateY(-2px) scale(1.02);
      }

      .type-pdf {
        color: #ef4444;
        background: #fef2f2;
      }

      .type-img {
        color: #3b82f6;
        background: #eff6ff;
      }

      .type-vid {
        color: #8b5cf6;
        background: #f5f3ff;
      }

      .file-title {
        font-weight: 600;
        font-size: 0.9rem;
        text-align: center;
        width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: var(--text-main);
      }

      .view-overlay {
        position: absolute;
        bottom: 12px;
        left: 0;
        width: 100%;
        text-align: center;
        opacity: 0;
        transform: translateY(8px);
        transition: all 0.16s;
        pointer-events: none;
      }

      .file-card:hover .view-overlay {
        opacity: 1;
        transform: translateY(0);
      }

      .btn-view {
        background: var(--primary);
        color: white;
        font-size: 0.75rem;
        padding: 5px 14px;
        border-radius: 20px;
        display: inline-block;
        box-shadow: 0 4px 14px rgba(15, 23, 42, 0.3);
      }

      /* Dropdown */
      .dropdown-menu {
        position: absolute;
        top: 36px;
        right: 8px;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: var(--shadow-menu);
        width: 170px;
        padding: 6px;
        z-index: 20;
        display: none;
        border: 1px solid var(--border);
        animation: fadeIn 0.14s ease-out;
      }

      .dropdown-menu.show {
        display: block;
      }

      .dropdown-item {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
        padding: 7px 10px;
        font-size: 0.8rem;
        color: var(--text-main);
        text-decoration: none;
        border-radius: 8px;
        background: none;
        border: none;
        cursor: pointer;
        text-align: left;
      }

      .dropdown-item:hover {
        background: #f1f5f9;
      }

      .dropdown-item.danger {
        color: var(--danger);
      }

      .dropdown-item.danger:hover {
        background: #fef2f2;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-4px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Modal */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.35);
        backdrop-filter: blur(4px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s;
      }

      .modal-backdrop.active {
        opacity: 1;
        pointer-events: auto;
      }

      .modal-panel {
        background: #ffffff;
        width: 90%;
        max-width: 420px;
        border-radius: 24px;
        padding: 24px 22px 20px 22px;
        box-shadow: 0 22px 50px rgba(15, 23, 42, 0.25);
        transform: scale(0.95) translateY(10px);
        transition: transform 0.18s;
      }

      .modal-backdrop.active .modal-panel {
        transform: scale(1) translateY(0);
      }

      .modal-title {
        font-size: 1.15rem;
        font-weight: 700;
        margin: 0;
      }

      .share-input-group {
        background: #f8fafc;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 4px;
        display: flex;
        gap: 6px;
        margin-top: 10px;
      }

      .share-link {
        flex: 1;
        border: none;
        background: transparent;
        padding: 8px 10px;
        font-size: 0.9rem;
        color: var(--text-sub);
      }

      .btn-copy {
        padding: 7px 12px;
        border-radius: 9px;
        background: #ffffff;
        border: 1px solid var(--border);
        cursor: pointer;
        font-weight: 600;
        font-size: 0.8rem;
      }

      .btn-copy:hover {
        background: #f1f5f9;
      }

      .switch-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 14px;
        margin-bottom: 10px;
      }

      .toggle-switch {
        position: relative;
        width: 44px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #cbd5e1;
        transition: .25s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .25s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(15, 23, 42, 0.25);
      }

      input:checked+.slider {
        background-color: var(--accent);
      }

      input:checked+.slider:before {
        transform: translateX(20px);
      }

      .share-modal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 12px;
        gap: 8px;
        font-size: 0.8rem;
      }

      .share-status-pill {
        padding: 4px 8px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        border: 1px solid var(--border);
        font-size: 0.75rem;
      }

      .share-status-pill.on {
        background: #dcfce7;
        color: #15803d;
        border-color: #86efac;
      }

      .share-status-pill.off {
        background: #f9fafb;
        color: var(--text-sub);
      }

      .share-status-pill i {
        font-size: 0.8rem;
      }

      .share-message {
        font-size: 0.78rem;
        color: var(--text-sub);
        min-height: 16px;
        transition: color 0.2s;
      }

      /* Toast */
      .toast {
        position: fixed;
        bottom: 16px;
        right: 16px;
        padding: 8px 12px;
        border-radius: 999px;
        box-shadow: 0 16px 40px rgba(15, 23, 42, 0.4);
        font-size: 0.78rem;
        display: none;
        align-items: center;
        gap: 8px;
        z-index: 1000;
        max-width: 260px;
        color: #e5e7eb;
      }

      .toast.show {
        display: inline-flex;
        animation: toastIn 0.2s ease-out;
      }

      @keyframes toastIn {
        from {
          opacity: 0;
          transform: translateY(10px) translateX(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0) translateX(0);
        }
      }

      .toast-icon {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .toast-success {
        background: #111827;
      }

      .toast-success .toast-icon {
        background: #22c55e1a;
      }

      .toast-success .toast-icon i {
        color: #4ade80;
      }

      .toast-error {
        background: #7f1d1d;
      }

      .toast-error .toast-icon {
        background: #fee2e2;
      }

      .toast-error .toast-icon i {
        color: #ef4444;
      }

      /* Upload queue */
      #uploadQueue {
        list-style: none;
        padding: 0;
        margin: 0 0 12px 0;
      }

      #uploadQueue li {
        padding: 7px 0;
        border-bottom: 1px solid var(--border);
        font-size: 0.86rem;
        display: flex;
        align-items: center;
        gap: 10px;
        opacity: 0;
        transform: translateY(4px);
        animation: rowEnter 0.18s forwards;
      }

      @keyframes rowEnter {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      #progressContainer {
        display: none;
        width: 100%;
        height: 4px;
        background: #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 4px;
      }

      #progressBar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #22c55e, #16a34a);
        transition: width 0.25s;
      }

      /* Root drop area */
      .root-drop-hint {
        margin-top: 32px;
        border-top: 1px dashed var(--border);
        padding-top: 16px;
        text-align: center;
        color: var(--text-sub);
        font-size: 0.85rem;
        transition: background 0.18s, border-color 0.18s, transform 0.18s;
      }

      .root-drop-hint.drag-target {
        background: #eff6ff;
        border-top-color: var(--accent);
        transform: translateY(-2px);
      }
    </style>
  </head>

  <body>
    <nav class="nav-bar">
      <div class="nav-left">
        <a href="/dashboard" class="brand">
          <div class="brand-logo">
            <i class="fas fa-cloud"></i>
          </div>
          <div>
            <div>CloudSpace</div>
            <div class="brand-sub">Fast & private cloud storage</div>
          </div>
        </a>

        <div class="breadcrumb-container">
          <a href="/dashboard" class="crumb <%= !currentFolder ? 'active' : '' %>">Home</a>
          <% breadcrumb.forEach(folder=> { %>
            <span class="crumb-sep">/</span>
            <a href="/dashboard/<%= folder._id %>" class="crumb">
              <%= folder.name %>
            </a>
            <% }) %>
              <% if(currentFolder) { %>
                <span class="crumb-sep">/</span>
                <span class="crumb active">
                  <%= currentFolder.name %>
                </span>
                <% } %>
        </div>
      </div>

      <form action="/search" method="GET" class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" name="q" class="search-input" placeholder="Search files..." />
      </form>

      <div class="nav-right">
        <div class="user-avatar">
          <%= currentUser && currentUser.username ? currentUser.username.charAt(0).toUpperCase() : 'U' %>
        </div>

        <span>
          Hi,
          <%= currentUser && currentUser.username ? currentUser.username : 'User' %>
        </span>

        <form action="/logout"  style="margin:0;">
          <button type="submit" class="btn-logout">
            <i class="fas fa-right-from-bracket"></i>
            Logout
          </button>
        </form>
        <button class="nav-toggle" onclick="toggleNavMobile()">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </nav>

    <div id="navMobilePanel" class="nav-mobile-panel">
      <form action="/search" method="GET" class="nav-mobile-search">
        <i class="fas fa-search search-icon"></i>
        <input type="text" name="q" placeholder="Search files..." />
      </form>
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="display:flex; align-items:center; gap:8px;">
          <div class="user-avatar">
            <%= currentUser && currentUser.name ? currentUser.name.charAt(0).toUpperCase() : 'U' %>
          </div>
          <span style="font-size:0.85rem;">Hi, <%= currentUser && currentUser.name ? currentUser.name : 'User' %></span>
        </div>
      </div>
    </div>

    <div class="main-container">

      <% function formatBytes(bytes) { if (bytes===0) return "0 B" ; const k=1024; const sizes=["B", "KB" , "MB" , "GB"
        , "TB" ]; const i=Math.floor(Math.log(bytes) / Math.log(k)); return (bytes / Math.pow(k, i)).toFixed(2) + " " +
        sizes[i]; } %>

        <div class="dashboard-header">
          <!-- LEFT: stats cards -->
          <div class="stats-group">
            <div class="stat-card">
              <div class="stat-icon-wrap stat-icon-db">
                <i class="fas fa-database"></i>
              </div>
              <div class="stat-content">
                <span class="stat-val">
                  <%= formatBytes(totalStorage) %>
                </span>
                <span class="stat-label">Used Storage</span>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon-wrap stat-icon-files">
                <i class="fas fa-file-alt"></i>
              </div>
              <div class="stat-content">
                <span class="stat-val">
                  <%= totalFiles %>
                </span>
                <span class="stat-label">Total Files</span>
              </div>
            </div>
          </div>

          <!-- RIGHT: folder form + bulk button -->
          <div class="header-actions">
            <form action="/folder/create" method="POST" class="folder-form">
              <input type="hidden" name="parentFolderId" value="<%= currentFolder ? currentFolder._id : '' %>" />
              <input type="text" name="name" placeholder="Folder Name" required />
              <button type="submit" class="btn btn-primary btn-folder-add">
                <i class="fas fa-plus"></i>
              </button>
            </form>

            <div style="position:relative;">
              <button type="button" class="btn btn-ghost btn-bulk-pill" onclick="toggleDropdown(event, 'bulk-menu')">
                <i class="fas fa-layer-group"></i> Bulk Actions
              </button>
              <div id="dropdown-bulk-menu" class="dropdown-menu" style="width:210px;">
                <select id="bulkFolderSelect"
                  style="width:100%; margin-bottom:8px; padding:6px; border:1px solid var(--border); border-radius:6px; font-size:0.8rem;">
                  <option value="">Move to Root</option>
                  <% folders.forEach(folder=> { %><option value="<%= folder._id %>">
                      <%= folder.name %>
                    </option>
                    <% }) %>
                </select>
                <button type="button" onclick="bulkMove()" class="dropdown-item">
                  <i class="fas fa-share"></i> Move selected
                </button>
                <button type="button" onclick="bulkDelete()" class="dropdown-item danger">
                  <i class="fas fa-trash"></i> Delete selected
                </button>
              </div>
            </div>
          </div>
        </div>

        <% if (currentUser.telegramVerified) { %>
          <input type="file" id="fileInput" multiple hidden />
          <div class="upload-area" id="dropZone">
            <i class="fas fa-cloud-arrow-up upload-icon"></i>
            <div class="upload-text">Drag files here or click to upload</div>
          </div>
          <ul id="uploadQueue"></ul>
          <div id="progressContainer">
            <div id="progressBar"></div>
          </div>
          <% } else { %>
            <div class="upload-area" style="cursor:default; opacity:0.7;">
              <i class="fas fa-lock upload-icon" style="color:#9ca3af;"></i>
              <div class="upload-text">Verify Telegram to enable uploads</div>
            </div>
            <% } %>

              <% if (currentFolder) { %>
                <div style="margin-bottom:18px;">
                  <a href="/dashboard/<%= currentFolder.parentFolderId || '' %>" class="btn btn-ghost">
                    <i class="fas fa-arrow-left"></i> Go back
                  </a>
                </div>
                <% } %>

                  <% if (folders.length> 0) { %>
                    <div class="section-head">
                      <div class="section-title">
                        <i class="fas fa-folder-open"></i> Folders
                      </div>
                    </div>
                    <div class="folder-grid">
                      <% folders.forEach(folder=> { %>
                        <div class="folder-card" ondragover="allowDrop(event)" ondragenter="folderDragEnter(event)"
                          ondragleave="folderDragLeave(event)" ondrop="dropFile(event)"
                          data-folder-id="<%= folder._id %>">
                          <a href="/dashboard/<%= folder._id %>" class="folder-info"
                            style="text-decoration:none; color:inherit;">
                            <i class="fas fa-folder folder-icon"></i>
                            <span class="folder-name">
                              <%= folder.name %>
                            </span>
                          </a>

                          <button class="menu-trigger" type="button" onclick="toggleDropdown(event, '<%= folder._id %>')">
                            <i class="fas fa-ellipsis-v"></i>
                          </button>
                          <div id="dropdown-<%= folder._id %>" class="dropdown-menu">
                            <button type="button" onclick="openShareModal('folder', '<%= folder._id %>')"
                              class="dropdown-item">
                              <i class="fas fa-link"></i> Share
                            </button>
                            <form action="/folder/<%= folder._id %>/delete-hard" method="POST"
                              onsubmit="return confirm('Delete folder?')">
                              <button type="submit" class="dropdown-item danger">
                                <i class="fas fa-trash"></i> Delete
                              </button>
                            </form>
                          </div>
                        </div>
                        <% }) %>
                    </div>
                    <% } %>

                      <div class="section-head">
                        <div class="section-title">
                          <i class="fas fa-file-lines"></i> Files
                        </div>
                        <form method="GET" action="/dashboard">
                          <select name="type" onchange="this.form.submit()"
                            style="padding:6px 10px; border-radius:8px; border:1px solid var(--border); background:white; font-size:0.8rem;">
                            <option value="">All files</option>
                            <option value="photo">Photos</option>
                            <option value="video">Videos</option>
                            <option value="document">Docs</option>
                          </select>
                        </form>
                      </div>

                      <% if (files.length===0) { %>
                        <div style="text-align:center; padding:40px; color:var(--text-sub);">
                          <i class="fas fa-box-open" style="font-size:3rem; margin-bottom:10px; opacity:0.35;"></i>
                          <p>No files in this folder.</p>
                        </div>
                        <% } %>

                          <div class="file-grid">
                            <% files.forEach(file=> { %>
                              <div class="file-card" draggable="true" ondragstart="dragFile(event)"
                                ondragend="dragEnd(event)" data-file-id="<%= file._id %>">
                                <div class="checkbox-wrapper">
                                  <input type="checkbox" class="file-checkbox" value="<%= file._id %>" />
                                </div>

                                <button class="menu-trigger" type="button"
                                  onclick="toggleDropdown(event, '<%= file._id %>')">
                                  <i class="fas fa-ellipsis-h"></i>
                                </button>

                                <div id="dropdown-<%= file._id %>" class="dropdown-menu">
                                  <button type="button" onclick="openShareModal('file', '<%= file._id %>')"
                                    class="dropdown-item">
                                    <i class="fas fa-share-nodes" style="width:18px;"></i> Share
                                  </button>
                                  <a href="/download/<%= file._id %>" class="dropdown-item">
                                    <i class="fas fa-download" style="width:18px;"></i> Download
                                  </a>
                                  <form action="/file/<%= file._id %>/delete" method="POST"
                                    onsubmit="return confirm('Delete permanently?')">
                                    <button type="submit" class="dropdown-item danger">
                                      <i class="fas fa-trash" style="width:18px;"></i> Delete
                                    </button>
                                  </form>
                                </div>

                                <div class="card-body"
                                  onclick="triggerView('<%= file._id %>', '<%= file.mimeType %>', '<%= file.fileType %>')">
                                  <div
                                    class="file-icon-box <%= file.mimeType==='application/pdf'?'type-pdf': (file.fileType==='photo'?'type-img': (file.fileType==='video'?'type-vid':'')) %>">
                                    <% if (file.mimeType==="application/pdf" ) { %>
                                      <i class="fas fa-file-pdf"></i>
                                      <% } else if (file.fileType==="photo" ) { %>
                                        <i class="fas fa-image"></i>
                                        <% } else if (file.fileType==="video" ) { %>
                                          <i class="fas fa-play-circle"></i>
                                          <% } else { %>
                                            <i class="fas fa-file-alt"></i>
                                            <% } %>
                                  </div>

                                  <div class="file-title" title="<%= file.fileName %>">
                                    <%= file.fileName %>
                                  </div>

                                  <div class="view-overlay">
                                    <span class="btn-view">View</span>
                                  </div>
                                </div>
                              </div>
                              <% }) %>
                          </div>

                          <div id="rootDropHint" class="root-drop-hint" ondragover="allowDrop(event)"
                            ondragenter="rootDragEnter(event)" ondragleave="rootDragLeave(event)"
                            ondrop="dropToRoot(event)">
                            Drop here to move to Root
                          </div>

    </div>

    <!-- Share Modal -->
    <div class="modal-backdrop" id="shareModal">
      <div class="modal-panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3 class="modal-title">Share access</h3>
          <button onclick="closeShareModal()"
            style="background:none; border:none; font-size:1.3rem; cursor:pointer; color:var(--text-sub);">
            &times;
          </button>
        </div>

        <div class="switch-group">
          <span style="font-weight:600; font-size:0.9rem;">Enable public link</span>
          <label class="toggle-switch">
            <input type="checkbox" id="shareToggle">
            <span class="slider"></span>
          </label>
        </div>

        <div id="shareLinkContainer" style="display:none;">
          <p style="font-size:0.82rem; color:var(--text-sub); margin-bottom:6px;">
            Anyone with this link can view this item.
          </p>
          <div class="share-input-group">
            <input type="text" id="shareLinkInput" class="share-link" readonly>
            <button type="button" class="btn-copy" onclick="copyLink()">Copy</button>
          </div>
        </div>

        <div class="share-modal-footer">
          <div id="shareStatusPill" class="share-status-pill off">
            <i class="fas fa-lock"></i><span>Link disabled</span>
          </div>
          <div id="shareMessage" class="share-message"></div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast toast-success">
      <div class="toast-icon">
        <i class="fas fa-check"></i>
      </div>
      <div id="toastText"></div>
    </div>


    <script>
/* ===============================
   DESKTOP STYLE BOX SELECTION
================================ */

let isSelecting = false;
let startX = 0;
let startY = 0;
let selectionBox = null;
let draggedFileIds = [];

/* Helpers */
function getAllFileCards() {
  return Array.from(document.querySelectorAll(".file-card"));
}

function clearSelection() {
  getAllFileCards().forEach(card => {
    card.classList.remove("selected");
    const cb = card.querySelector(".file-checkbox");
    if (cb) cb.checked = false;
  });
}

function selectCard(card) {
  card.classList.add("selected");
  const cb = card.querySelector(".file-checkbox");
  if (cb) cb.checked = true;
}

function intersects(a, b) {
  return !(
    a.right < b.left ||
    a.left > b.right ||
    a.bottom < b.top ||
    a.top > b.bottom
  );
}

function getSelectedFileIds() {
  return getAllFileCards()
    .filter(card => card.classList.contains("selected"))
    .map(card => card.dataset.fileId);
}

/* Selection start */
document.addEventListener("mousedown", (e) => {
  if (
    e.target.closest(".file-card") ||
    e.target.closest("button") ||
    e.target.closest("input") ||
    e.target.closest("a")
  ) return;

  isSelecting = true;
  startX = e.clientX;
  startY = e.clientY;

  clearSelection();

  selectionBox = document.createElement("div");
  selectionBox.className = "selection-box";
  document.body.appendChild(selectionBox);
});

/* Selection move */
document.addEventListener("mousemove", (e) => {
  if (!isSelecting || !selectionBox) return;

  const x = Math.min(e.clientX, startX);
  const y = Math.min(e.clientY, startY);
  const w = Math.abs(e.clientX - startX);
  const h = Math.abs(e.clientY - startY);

  selectionBox.style.left = x + "px";
  selectionBox.style.top = y + "px";
  selectionBox.style.width = w + "px";
  selectionBox.style.height = h + "px";

  const boxRect = selectionBox.getBoundingClientRect();

  getAllFileCards().forEach(card => {
    const cardRect = card.getBoundingClientRect();
    if (intersects(boxRect, cardRect)) {
      selectCard(card);
    }
  });
});

/* Selection end */
document.addEventListener("mouseup", () => {
  if (!isSelecting) return;
  isSelecting = false;

  if (selectionBox) {
    selectionBox.remove();
    selectionBox = null;
  }
});

/* ===============================
   MULTI FILE DRAG & DROP
================================ */

function dragFile(e) {
  const card = e.currentTarget;

  if (!card.classList.contains("selected")) {
    clearSelection();
    selectCard(card);
  }

  draggedFileIds = getSelectedFileIds();

  draggedFileIds.forEach(id => {
    const el = document.querySelector(`.file-card[data-file-id="${id}"]`);
    if (el) el.style.opacity = "0.5";
  });

  e.dataTransfer.effectAllowed = "move";
}

function dragEnd() {
  draggedFileIds.forEach(id => {
    const el = document.querySelector(`.file-card[data-file-id="${id}"]`);
    if (el) el.style.opacity = "1";
  });
  draggedFileIds = [];
}

/* Folder drop */
async function dropFile(e) {
  e.preventDefault();
  const folderId = e.currentTarget.dataset.folderId;
  e.currentTarget.classList.remove("drag-target");

  if (!draggedFileIds.length) return;

  await fetch("/files/bulk-move", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ ids: draggedFileIds, folderId })
  });

  location.reload();
}

/* Root drop */
async function dropToRoot(e) {
  e.preventDefault();
  document.getElementById("rootDropHint").classList.remove("drag-target");

  if (!draggedFileIds.length) return;

  await fetch("/files/bulk-move", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ ids: draggedFileIds, folderId: null })
  });

  location.reload();
}
</script>



    <script>
      /* Responsive navbar */
      function toggleNavMobile() {
        const panel = document.getElementById('navMobilePanel');
        panel.classList.toggle('show');
      }

      /* Dropdown logic */
      function toggleDropdown(event, id) {
        event.stopPropagation();
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
          if (menu.id !== `dropdown-${id}`) menu.classList.remove('show');
        });
        const menu = document.getElementById(`dropdown-${id}`);
        if (menu) menu.classList.toggle('show');
      }

      window.onclick = function (event) {
        if (!event.target.closest('.menu-trigger')) {
          document.querySelectorAll('.dropdown-menu').forEach(menu => menu.classList.remove('show'));
        }
      }

      /* View logic */
      function triggerView(id, mime, type) {
        if (mime === "application/pdf" || type === "video" || type === "photo") {
          window.open(`/preview/${id}`, '_blank');
        } else {
          alert("Preview not available for this file type. Please download.");
        }
      }

      /* Toast helper */
      const toastEl = document.getElementById('toast');
      const toastText = document.getElementById('toastText');
      let toastTimeout = null;

      function showToast(message, type) {
        toastEl.classList.remove('toast-success', 'toast-error');
        toastEl.classList.add(type === 'error' ? 'toast-error' : 'toast-success');

        const iconDiv = toastEl.querySelector('.toast-icon');
        iconDiv.innerHTML = type === 'error'
          ? '<i class="fas fa-times"></i>'
          : '<i class="fas fa-check"></i>';

        toastText.textContent = message;
        toastEl.classList.add('show');

        if (toastTimeout) clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
          toastEl.classList.remove('show');
        }, 2600);
      }

      /* Share modal logic */
      const modal = document.getElementById('shareModal');
      const shareToggle = document.getElementById('shareToggle');
      const linkContainer = document.getElementById('shareLinkContainer');
      const linkInput = document.getElementById('shareLinkInput');
      const shareStatusPill = document.getElementById('shareStatusPill');
      const shareMessage = document.getElementById('shareMessage');
      let currentShareInfo = { type: null, id: null };
      let internalToggleChange = false;

      function setShareStatus(on, message, toastMsg, toastType) {
        if (on) {
          shareStatusPill.classList.remove('off');
          shareStatusPill.classList.add('on');
          shareStatusPill.innerHTML = '<i class="fas fa-unlock"></i><span>Link active</span>';
          shareMessage.textContent = message || "Sharing enabled. Anyone with the link can view.";
          shareMessage.style.color = "var(--success)";
        } else {
          shareStatusPill.classList.remove('on');
          shareStatusPill.classList.add('off');
          shareStatusPill.innerHTML = '<i class="fas fa-lock"></i><span>Link disabled</span>';
          shareMessage.textContent = message || "Sharing disabled. Existing links no longer work.";
          shareMessage.style.color = "var(--text-sub)";
        }
        if (toastMsg) showToast(toastMsg, toastType || (on ? 'success' : 'error'));
      }

      async function openShareModal(type, id) {
        currentShareInfo = { type, id };
        modal.classList.add('active');
        internalToggleChange = true;
        shareToggle.checked = false;
        linkContainer.style.display = 'none';
        setShareStatus(false, "");

        try {
          const res = await fetch(`/${type}/${id}/share`, { method: "POST" });
          const data = await res.json();
          if (data.link) {
            shareToggle.checked = true;
            linkInput.value = data.link;
            linkContainer.style.display = 'block';
            setShareStatus(true, "Sharing enabled. Link ready to share.");
          }
        } catch (e) {
          console.error(e);
          setShareStatus(false, "Could not check sharing state.", "Failed to fetch share link", "error");
        } finally {
          internalToggleChange = false;
        }
      }

      function closeShareModal() {
        modal.classList.remove('active');
      }

      shareToggle.addEventListener('change', async () => {
        if (!currentShareInfo.type || internalToggleChange) return;
        const { type, id } = currentShareInfo;
        if (shareToggle.checked) {
          try {
            const res = await fetch(`/${type}/${id}/share`, { method: "POST" });
            const data = await res.json();
            linkInput.value = data.link;
            linkContainer.style.display = 'block';
            setShareStatus(true, "Sharing enabled. Link updated.", "Sharing enabled", "success");
          } catch {
            setShareStatus(false, "Error enabling sharing.", "Error enabling sharing", "error");
            shareToggle.checked = false;
          }
        } else {
          try {
            await fetch(`/${type}/${id}/unshare`, { method: "POST" });
            linkContainer.style.display = 'none';
            setShareStatus(false, "Sharing disabled for this item.", "Sharing disabled", "error");
          } catch {
            setShareStatus(true, "Error disabling sharing. Link may still be active.", "Error disabling sharing", "error");
            shareToggle.checked = true;
          }
        }
      });

      function copyLink() {
        linkInput.select();
        document.execCommand("copy");
        const btn = document.querySelector('.btn-copy');
        btn.textContent = "Copied!";
        setTimeout(() => btn.textContent = "Copy", 1800);
        setShareStatus(true, "Link copied. You can paste it anywhere.", "Link copied", "success");
      }

      /* Upload logic */
      const fileInput = document.getElementById("fileInput");
      const dropZone = document.getElementById("dropZone");
      const queueList = document.getElementById("uploadQueue");
      const progressContainer = document.getElementById("progressContainer");
      const progressBar = document.getElementById("progressBar");
      const currentFolderId = "<%= currentFolder ? currentFolder._id : "" %>";
      let queue = [];
      let uploading = false;

      if (dropZone && fileInput) {
        dropZone.onclick = () => fileInput.click();
        dropZone.ondragover = e => { e.preventDefault(); dropZone.classList.add('drag-over'); };
        dropZone.ondragleave = () => dropZone.classList.remove('drag-over');
        dropZone.ondrop = e => {
          e.preventDefault();
          dropZone.classList.remove('drag-over');
          addToQueue(Array.from(e.dataTransfer.files));
        };
        fileInput.onchange = () => addToQueue(Array.from(fileInput.files));
      }

      function addToQueue(files) {
        files.forEach(f => {
          queue.push(f);
          const li = document.createElement("li");
          li.innerHTML = `<span><i class="fas fa-spinner fa-spin" style="color:var(--accent)"></i> ${f.name}</span>`;
          li.dataset.name = f.name;
          queueList.appendChild(li);
        });
        if (!uploading) processQueue();
      }

      function processQueue() {
        if (queue.length === 0) {
          uploading = false;
          setTimeout(() => location.reload(), 900);
          return;
        }
        uploading = true;
        const file = queue.shift();
        progressContainer.style.display = 'block';
        progressBar.style.width = '0%';

        const formData = new FormData();
        formData.append("file", file);
        formData.append("folderId", currentFolderId);

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/upload-stream");
        xhr.upload.onprogress = e => {
          if (e.lengthComputable) {
            const pct = Math.round((e.loaded / e.total) * 100);
            progressBar.style.width = pct + "%";
          }
        };
        xhr.onload = () => {
          const li = [...queueList.children].find(el => el.dataset.name === file.name);
          if (li) {
            li.innerHTML = `<span style="color:var(--success)"><i class="fas fa-check-circle"></i> ${file.name}</span>`;
          }
          showToast("Upload finished", "success");
          processQueue();
        };
        xhr.onerror = () => {
          const li = [...queueList.children].find(el => el.dataset.name === file.name);
          if (li) {
            li.innerHTML = `<span style="color:var(--danger)"><i class="fas fa-circle-exclamation"></i> ${file.name}</span>`;
          }
          showToast("Upload failed", "error");
          processQueue();
        };
        xhr.send(formData);
      }

      /* Bulk + drag/drop */
      function getSelectedFiles() {
        return Array.from(document.querySelectorAll(".file-checkbox:checked")).map(cb => cb.value);
      }

      async function bulkDelete() {
        const ids = getSelectedFiles();
        if (ids.length === 0) return alert("Select files first");
        if (!confirm("Delete selected?")) return;
        await fetch("/files/bulk-delete", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ids })
        });
        location.reload();
      }

      async function bulkMove() {
        const ids = getSelectedFiles();
        const folderId = document.getElementById("bulkFolderSelect").value;
        if (ids.length === 0) return alert("Select files first");
        await fetch("/files/bulk-move", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ids, folderId })
        });
        location.reload();
      }

      let draggedFileId = [] ;
      function dragFile(e) {
    const card = e.currentTarget;

    // If dragged file is NOT selected, select only it
    if (!card.classList.contains("selected")) {
      document.querySelectorAll(".file-card.selected").forEach(c => {
        c.classList.remove("selected");
        c.querySelector(".file-checkbox").checked = false;
      });

      card.classList.add("selected");
      card.querySelector(".file-checkbox").checked = true;
    }

    // Collect all selected files
    draggedFileIds = getSelectedFileIds();

    // Visual feedback
    draggedFileIds.forEach(id => {
      const el = document.querySelector(`.file-card[data-file-id="${id}"]`);
      if (el) el.style.opacity = "0.5";
    });

    e.dataTransfer.effectAllowed = "move";
  }

      function dragEnd() {
    draggedFileIds.forEach(id => {
      const el = document.querySelector(`.file-card[data-file-id="${id}"]`);
      if (el) el.style.opacity = "1";
    });

    draggedFileIds = [];
  }


      function allowDrop(e) {
        e.preventDefault();
      }

      function folderDragEnter(e) {
        e.preventDefault();
        e.currentTarget.classList.add('drag-target');
      }
      function folderDragLeave(e) {
        e.currentTarget.classList.remove('drag-target');
      }

      async function dropFile(e) {
    e.preventDefault();
    const folderId = e.currentTarget.dataset.folderId;
    e.currentTarget.classList.remove('drag-target');

    if (!draggedFileIds.length) return;

    await fetch("/files/bulk-move", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        ids: draggedFileIds,
        folderId
      })
    });

    showToast(`${draggedFileIds.length} file(s) moved`, "success");
    location.reload();
  }


      function rootDragEnter(e) {
        e.preventDefault();
        document.getElementById('rootDropHint').classList.add('drag-target');
      }
      function rootDragLeave(e) {
        document.getElementById('rootDropHint').classList.remove('drag-target');
      }

      async function dropToRoot(e) {
    e.preventDefault();
    document.getElementById('rootDropHint').classList.remove('drag-target');

    if (!draggedFileIds.length) return;

    await fetch("/files/bulk-move", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        ids: draggedFileIds,
        folderId: null
      })
    });

    showToast(`${draggedFileIds.length} file(s) moved to Root`, "success");
    location.reload();
  }

    </script>
  </body>

  </html>